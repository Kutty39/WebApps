$(document).ready(function() {
	loadpage();
	// this will bind the method for currently available elements
	$("a.button").click(loadpage);
	// this on method will bind the methods to future elements
	$("#ajx").on("blur","input[type!='submit']",($(this), mandChecker));
	$("#ajx").on("keyup","input[type!='submit']",($(this), mandChecker));
	$("#ajx").on("blur","#eid",check);
	$("#ajx").on("blur","#usr",check);
	$("#ajx").on("click","#regBtn",regsubm);
	$("#ajx").on("click","#lgnbtn",lgnsubm);
});
function lgnsubm(){
	$("form").submit(function(event) {
		event.preventDefault();
		return;
	});
	$.ajax({
		type : $("form").attr('method'),
		url : "regestration",
		data :$("form").serialize(),
		success : function(msg) {
			$("#ajx").html(msg);
		},
		dataType : "html"
	});
	event.preventDefault();
}
function regsubm(){
	$("form").submit(function(event) {
		$("p.hd-lbl").each(function() {
			if (this.style.display == "block") {
				event.preventDefault();
				return;
			}
		});
		$.ajax({
			type : $("form").attr('method'),
			url : "regestration",
			data :$("form").serialize(),
			success : function(msg) {
				$("#ajx").html(msg);
			},
			dataType : "html"
		});
		event.preventDefault();
	});
}
function loadpage() {
	var cls = $(this).attr('class');
	$.ajax({
		type : "get",
		url : "switchpage",
		data : "page=" + text(cls),
		success : function(msg) {
			$("#ajx").html(msg);
		},
		dataType : "html"
	});
}
function text(cls){
	if(cls==null){
		return "home";
	}else if(cls.indexOf("login")>0){
		return "login";
	}else if(cls.indexOf("register")>0){
		return "register";
	}else{
		return "home";
	}
}
function check(){
	var obj=$(this);
	if(obj!=null){
	$.ajax({
		type : "get",
		url : "validate",
		data : {"email":obj.val()},
		success : function(msg) {
			if(msg=="true"){
				if(obj.attr("name")=='eid'){
				$(".hd-lbl.eid").text("*Email alread exists.");
				$(".hd-lbl.eid").show();
				}
			}else{
				if(obj.attr("name")=='username'){
					$(".hd-lbl.eid").text("*Email is not exists. please register and come back");
					$(".hd-lbl.eid").show();
				}
			}
		}
	});
	}
}

function mandChecker(element) {
	var val = element.target.value;
	var name = element.target.name;
	var obj = $(".hd-lbl." + name);

	if (val == "") {
		obj.show();
	} else {
		obj.show();
		var regx = "";
		if (name == "phn") {
			regx = /^\d{10}$/;
			if (regx.test(val)) {
				obj.hide();
			} else {
				obj.text("* Phone number should be 10 digit");
			}
		} else if (name == "eid") {
			regx = /^[a-zA-z\d._-]+\@[a-zA-Z\d.-]+\.[a-zA-Z]{2,4}$/;
			if (regx.test(val)) {
				obj.hide();
			} else {
				obj.text("* Please enter valid email.");
			}
		} else if (name == "pas") {
			regx = /^((?=.*[a-z])(?=.*[A-Z])(?!.*\s)(?=.*[@$!%*?&])).{8,15}$/;
			if (regx.test(val)) {
				obj.hide();
			} else {
				obj.show;
			}
		} else if (name == "conpas") {
			var ps = $("input[name='pas']").val();
			if (val == ps) {
				obj.hide();
			} else {
				obj.show;
			}
		} else {
			obj.hide();
		}
	}
}